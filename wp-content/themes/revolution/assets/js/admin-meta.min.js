jQuery(function(d){d(".thb-register:not(.disabled)").on("click",function(e){var a=d(this),t=d("#thb_product_key").val(),n=d("#thb_purchase_code").val(),s=a.hasClass("thb_purchase_code"),i=s?a.data("verify-by-purchase"):a.data("verify"),o={domain:a.data("domain")};return s?o.purchase_code=n:o.product_key=t,d.ajax({method:"GET",url:i,data:o,beforeSend:function(){a.addClass("disabled")},error:function(e){var t;a.removeClass("disabled"),!e.responseText||(t=d.parseJSON(e.responseText)).error_message&&("Invalid product_key"===t.error_message?a.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> Invalid Product Key</p><p><small>Please make sure that you are using the exactly the same​ WordPress URL inside Settings > General.</small></p></div>'):"Invalid purchase_code"===t.error_message?a.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> Invalid Envato Purchase Code</p><p><small>Please make sure that you are using the correct Envato Purchase Code for this theme.</small></p></div>'):"Invalid domain"===t.error_message?a.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> Invalid Domain</p><p><small>Please make sure that you are using the exactly the same​ WordPress URL inside Settings > General.</small></p></div>'):a.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> '+t.error_message+"</p></div>"))},success:function(e){e.product_key&&(t=e.product_key),d.ajax(ajaxurl,{method:"POST",data:{action:"thb_update_options",key:t,expired:0,security:a.data("security")},success:function(){location.reload()}})}}),!1}),d(".thb-delete-key").on("click",function(e){var t=d(this);return d.ajax(ajaxurl,{method:"POST",data:{action:"thb_update_options",key:"",expired:0,security:t.data("security")},success:function(){location.reload()}}),!1});var n={popup:d("#thb-adm-popup"),close:d(".thb-popup-close"),btn:d(".import-opts-btn")};n.close.on("click",function(){d(this).closest(n.popup).removeClass("opvis")}),d(document).on("keyup",function(e){27===e.keyCode&&n.popup.hasClass("opvis")&&n.close.trigger("click")}),d(".thb-check-line [type=checkbox]").on("change",function(){var e=d(this);e.toggleClass("thb-checked"),"ty-contents"===e.attr("id")&&(e.hasClass("child-opened")?e.removeClass("child-opened").parent().next().removeClass("done"):e.addClass("child-opened").parent().next().addClass("done"))}),n.btn.on("click",function(){var e=d(this),t=e.data("demo");n.popup.find(".button").data("selected",t),n.popup.find("figure img").attr("src",e.closest(".theme").find("img").attr("src")),n.popup.find("[type=checkbox]"),n.popup.addClass("opvis")});var a,s,i=new FormData;"undefined"!=typeof ocdi&&(i.append("action","ocdi_import_demo_data"),i.append("security",ocdi.ajax_nonce)),n.popup.find("form").on("submit",function(e){e.preventDefault();var t=d(this),a=t.find(".button").data("selected");n.popup.find("form").addClass("thb-loading"),t.closest(".thb-popup-box").find(".thb-import-loading").addClass("opvis"),t.children("[type=submit]").addClass("disabled").attr("disabled","disabled").unbind("click"),i.append("selected",a),i.append("thb_import_options",t.serialize()),function a(n){d.ajax({method:"POST",url:ocdi.ajax_url,data:n,contentType:!1,processData:!1}).done(function(e){var t;void 0!==e.status&&"newAJAX"===e.status?a(n):void 0!==e.status&&"afterAllImportAJAX"===e.status?((t=new FormData).append("action","ocdi_after_import_data"),t.append("security",ocdi.ajax_nonce),a(t)):location.reload()})}(i)}),d(".thb-button-creator-btn").length&&(a=d("#wp-link-wrap"),s=a.children("#wp-link"),d(".thb-button-creator-btn").on("click",function(){var e=d(this),t=d(".thb-button-creator-btn").data("thb-settings"),i=t.fields,o=e.next("[type=hidden]"),l=e.closest(".format-setting-wrap");t.height&&a.css("height",t.height+"px"),s.find("#link-modal-title").text(e.text()+" Button"),s.find("#wp-link-submit").attr("type","button").val(e.text()),s.find("#wp-link-url").val(l.find(".thb-button-url")[0].childNodes[1].nodeValue.trim()),s.find("#wp-link-text").val(l.find(".thb-button-link-text")[0].childNodes[1].nodeValue.trim()),Object.keys(i).forEach(function(t){var e=i[t];switch(s.find("#search-panel").append('<h6 class="thb-link-title thb-'+t+'">'+e.label+"</h6>"),e.type){case"select":e.data.forEach(function(e){var a="",n=l.find(".thb-btn-currents .thb-"+t+"__"+e.id)[0].childNodes[1].nodeValue.trim();e.data.forEach(function(e){var t="";n===e.label&&(t=" selected"),a+='<option value="'+e.value+'"'+t+">"+e.label+"</option>"}),s.find("#search-panel").append('<div class="thb-link-select-field"><label><span>'+e.label+'</span><div><select name="thb-'+t+"__"+e.id+'">'+a+"</select><small>"+e.desc+"</small></div></label></div>")})}}),a.addClass("thb-opened"),d("#wp-link-backdrop, #wp-link-wrap, #wp-link-wrap .wp-link-text-field").show(),s.find("#wp-link-submit").one("click",function(){var a={url:d("#wp-link-url").val(),text:d("#wp-link-text").val(),target:d("#wp-link-target").prop("checked")?"_blank":"_self"};Object.keys(i).forEach(function(t){i[t].data.forEach(function(e){a["thb-"+t+"__"+e.id]=d("[name=thb-"+t+"__"+e.id+"]").val()})}),o.val(JSON.stringify(a)),l.find(".thb-button-url")[0].childNodes[1].nodeValue=a.url,l.find(".thb-button-link-text")[0].childNodes[1].nodeValue=a.text,l.find(".thb-button-target")[0].childNodes[1].nodeValue=a.target,delete a.url,delete a.text,delete a.target;var n="",s=0;console.log(a),Object.keys(a).forEach(function(e){var t=a[e];n!==e.split("thb-")[1].split("__")[0]&&(s=0),n=e.split("thb-")[1].split("__")[0],l.find("."+e)[0].childNodes[1].nodeValue=i[n].data.map(function(e){return e.data.filter(function(e){return e.value===t})})[s][0].label,s++}),d("#wp-link-close").trigger("click")}),d("#wp-link-backdrop, #wp-link-close, #wp-link-cancel button").off().one("click",function(){d("#wp-link-backdrop, #wp-link-wrap, #wp-link-wrap .wp-link-text-field").hide(),s.find(".thb-link-title, .thb-link-select-field").remove(),s.find("#wp-link-submit").off()}),d(document).on("keyup",function(e){27===e.keyCode&&a.hasClass("thb-opened")&&d("#wp-link-close").trigger("click")})}))});